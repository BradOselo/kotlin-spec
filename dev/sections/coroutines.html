<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Marat Akhin" />
  <meta name="author" content="Mikhail Belyaev" />
  <title>Kotlin language specification</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" href="../resources/css/main.css">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script data-main="resources/js/main" src="https://requirejs.org/docs/release/2.3.6/minified/require.js"></script>
  <script>
      requirejs.config({
          waitSeconds: 10000
      });
  </script>
</head>
<body>
<header>
<h1 class="title">Kotlin language specification</h1>
<p class="author">Marat Akhin</p>
<p class="author">Mikhail Belyaev</p>
</header>




























<h2 id="coroutines"><span class="header-section-number">0.1</span> Coroutines</h2>
<div class="TODO">
<div class="paragraph">
<p><span class="sentence">TODO([Kotlin 1.3+, Experimental] Everything: state machine, context, etc.) TODO([Kotlin 1.3+, Experimental] Update w.r.t. structured concurrency)</span></p>
</div>
</div>
<h3 id="suspending-functions"><span class="header-section-number">0.1.1</span> Suspending functions</h3>
<div class="paragraph">
<p><span class="sentence">Most <a href="declarations.html#function-declaration">functions</a> in Kotlin may be marked <em>suspending</em> using the special <code>suspend</code> modifier. </span><span class="sentence">There are almost no additional restrictions: regular functions, extension functions, top-level functions, local functions, lambda literals, all these may be suspending functions.</span></p>
</div>
<blockquote>
<div class="paragraph">
<p><span class="sentence">Note: the following functions and function values cannot be marked as suspending.</span></p>
</div>
<ul>
<li><span class="sentence"><a href="expressions.html#anonymous-function-declarations">anonymous function declarations</a>;</span></li>
<li><span class="sentence"><a href="declarations.html#class-declaration">constructors</a>;</span></li>
<li><span class="sentence"><a href="declarations.html#getters-and-setters">property getter/setters</a>;</span></li>
<li><span class="sentence"><a href="declarations.html#delegated-property-declaration">delegation-related operator functions</a>.</span></li>
</ul>
</blockquote>
<blockquote>
<div class="paragraph">
<p><span class="sentence">Note: platform-specific implementations may extend the restrictions on which kinds of functions may be suspending.</span></p>
</div>
</blockquote>
<div class="paragraph">
<p><span class="sentence">Suspeding functions have a <a href="type-system.html#suspending-function-types">suspending function type</a>, also marked using the <code>suspend</code> modifier.</span></p>
</div>
<div class="TODO">
<div class="paragraph">
<p><span class="sentence">TODO(<code>suspend val</code>?)</span></p>
</div>
</div>
<div class="paragraph">
<p><span class="sentence">A suspending function is different from non-suspending functions by potentially having zero or more <em>suspension points</em> â€” statements in its body which may pause the function execution to be resumed at a later moment in time. </span><span class="sentence">The main source of suspension points are calls to other suspending functions which represent possible suspension points.</span></p>
</div>
<blockquote>
<div class="paragraph">
<p><span class="sentence">Note: suspension points are important because at these points another function may start in the same flow of execution, leading to potential changes in the shared state.</span></p>
</div>
</blockquote>
<div class="paragraph">
<p><span class="sentence">Non-suspending functions may not call suspending functions directly, as they do not support suspension points. </span><span class="sentence">Suspending functions may call non-suspending functions without any limitations; such calls do not create suspension points.</span></p>
</div>
<blockquote>
<div class="paragraph">
<p><span class="sentence">Important: an exception to this rule are non-suspending inlined lambda parameters: if the higher-order function invoking such a lambda is called from a suspending function, this lambda is allowed to also have suspension points and call other suspending functions.</span></p>
</div>
</blockquote>
<blockquote>
<div class="paragraph">
<p><span class="sentence">Note: suspending functions interleaving each other in this manner are not dissimilar to how functions from different threads interact on platforms with multi-threading support. </span><span class="sentence">There are, however, several key differences. </span><span class="sentence">First, suspending functions may pause only at suspension points, i.e., they cannot be paused at an arbitrary execution point. </span><span class="sentence">Second, this interleaving may happen on a single platform thread.</span></p>
</div>
<div class="paragraph">
<p><span class="sentence">In a multi-threaded environment suspending functions may also be interleaved by the platform-dependent concurrent execution, independent of the interleaving of coroutines.</span></p>
</div>
</blockquote>
<div class="paragraph">
<p><span class="sentence">The implementation of suspending functions is platform-dependent. </span><span class="sentence">Please refer to the platform documentation for details.</span></p>
</div>
<h3 id="coroutines-1"><span class="header-section-number">0.1.2</span> Coroutines</h3>
<div class="paragraph">
<p><span class="sentence">A <em>coroutine</em> is a concept similar to a thread in traditional concurrent programming, but based on <em>cooperative multitasking</em>, e.g., the switching between different execution contexts is done by the coroutines themselves rather than the operating system or a virtual machine.</span></p>
</div>
<div class="paragraph">
<p><span class="sentence">In Kotlin, coroutines are used to implement <a href="coroutines.html#suspending-functions">suspending functions</a> and can switch contexts only at suspension points.</span></p>
</div>
<div class="paragraph">
<p><span class="sentence">A call to a suspending function creates and starts a coroutine. </span><span class="sentence">As one can call a suspending function only from another suspending function, we need a way to bootstrap this process from a non-suspending context.</span></p>
</div>
<blockquote>
<div class="paragraph">
<p><span class="sentence">Note: this is required as most platforms are unaware of coroutines or suspending functions, and do not provide a suspending entry point. </span><span class="sentence">However, a Kotlin compiler may elect to provide a suspending entry point on a specific platform.</span></p>
</div>
</blockquote>
<div class="paragraph">
<p><span class="sentence">One of the ways of starting suspending function from a non-suspending context is via a <em>coroutine builder</em>: a non-suspending function which takes a suspending function type argument (e.g., a suspending lambda literal) and handles the coroutine lifecycle.</span></p>
</div>
<div class="paragraph">
<p><span class="sentence">The implementation of coroutines is platform-dependent. </span><span class="sentence">Please refer to the platform documentation for details.</span></p>
</div>
<div class="TODO">
<div class="paragraph">
<p><span class="sentence">TODO(Coroutine support in the standard library?)</span></p>
</div>
</div>
</body>
</html>
